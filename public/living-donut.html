<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QOTE Living Donut</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4338ca;
            --secondary: #10b981;
            --dark: #1f2937;
            --light: #f3f4f6;
            --accent: #8b5cf6;
            --danger: #ef4444;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: var(--light);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 20px 0;
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, var(--primary) 0%, var(--accent) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #94a3b8;
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
        }
        
        .card {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .card-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: var(--secondary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        label {
            font-size: 0.9rem;
            color: #94a3b8;
        }
        
        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        input[type="range"] {
            flex: 1;
            -webkit-appearance: none;
            height: 5px;
            background: rgba(99, 102, 241, 0.3);
            border-radius: 5px;
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            transition: background 0.3s;
        }
        
        input[type="range"]::-webkit-slider-thumb:hover {
            background: var(--primary-dark);
        }
        
        .value-display {
            min-width: 40px;
            text-align: center;
            font-weight: bold;
            color: var(--primary);
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(99, 102, 241, 0.3);
            transition: .4s;
            border-radius: 24px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: var(--secondary);
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
        
        .button {
            background: linear-gradient(90deg, var(--primary) 0%, var(--accent) 100%);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s, opacity 0.2s;
        }
        
        .button:hover {
            transform: translateY(-2px);
            opacity: 0.9;
        }
        
        .button:active {
            transform: translateY(0);
        }
        
        .button.secondary {
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid var(--primary);
        }
        
        .button.export {
            background: linear-gradient(90deg, #059669 0%, #10b981 100%);
        }
        
        .visualization {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 400px;
            position: relative;
        }
        
        .donut-container {
            position: relative;
            width: 300px;
            height: 300px;
        }
        
        .donut {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(
                var(--primary) 0% 20%,
                var(--secondary) 20% 40%,
                var(--accent) 40% 60%,
                #ec4899 60% 80%,
                #f59e0b 80% 100%
            );
            mask: radial-gradient(circle, transparent 50%, black 51%);
            -webkit-mask: radial-gradient(circle, transparent 50%, black 51%);
            animation: rotate 30s linear infinite;
        }
        
        .donut-inner {
            position: absolute;
            width: 70%;
            height: 70%;
            background: #1e293b;
            border-radius: 50%;
            top: 15%;
            left: 15%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 10px;
            padding: 20px;
            text-align: center;
        }
        
        .delta-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--secondary);
        }
        
        .delta-label {
            font-size: 0.9rem;
            color: #94a3b8;
        }
        
        .status {
            font-size: 0.8rem;
            padding: 5px 10px;
            border-radius: 20px;
            background: rgba(16, 185, 129, 0.2);
            color: var(--secondary);
        }
        
        .resonance-map {
            margin-top: 30px;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        
        .pulse {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--secondary);
            box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
            animation: pulse 2s infinite;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        @keyframes rotate {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }
        
        @keyframes pulse {
            0% {
                transform: translate(-50%, -50%) scale(0.95);
                box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
            }
            
            70% {
                transform: translate(-50%, -50%) scale(1);
                box-shadow: 0 0 0 10px rgba(16, 185, 129, 0);
            }
            
            100% {
                transform: translate(-50%, -50%) scale(0.95);
                box-shadow: 0 0 0 0 rgba(16, 185, 129, 0);
            }
        }
        
        .footer {
            text-align: center;
            margin-top: 40px;
            color: #94a3b8;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>QOTE Living Donut</h1>
            <p class="subtitle">Visualize quantum oscillator thermodynamics and entanglement with the QOTE engine simulation</p>
        </header>
        
        <div class="dashboard">
            <div class="card">
                <h2 class="card-title">
                    <span>Controls</span>
                </h2>
                <div class="controls">
                    <div class="control-group">
                        <label for="cust-input">CUST Gating (Coupling Strength)</label>
                        <div class="slider-container">
                            <input type="range" id="cust-input" min="0" max="100" value="50">
                            <span class="value-display" id="cust-value">50%</span>
                        </div>
                    </div>
                    
                    <div class="control-group">
                        <label for="theta-input">Delta Theta (Δθ) - Phase Difference</label>
                        <div class="slider-container">
                            <input type="range" id="theta-input" min="0" max="100" value="30">
                            <span class="value-display" id="theta-value">30%</span>
                        </div>
                    </div>
                    
                    <div class="control-group">
                        <label for="resonance-toggle">Resonance Map</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="resonance-toggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="control-group">
                        <label for="quantum-toggle">Quantum Entanglement</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="quantum-toggle">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <button class="button" id="optimize-btn">Optimize Parameters</button>
                    <button class="button secondary" id="reset-btn">Reset to Defaults</button>
                    <button class="button export" id="export-btn">Export for Deck</button>
                </div>
            </div>
            
            <div class="card">
                <h2 class="card-title">
                    <span>Visualization</span>
                </h2>
                <div class="visualization">
                    <div class="donut-container">
                        <div class="donut"></div>
                        <div class="donut-inner">
                            <span class="delta-label">Order Parameter R</span>
                            <span class="delta-value" id="delta-display">0.73</span>
                            <span class="status">STABLE</span>
                        </div>
                        <div class="pulse"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card resonance-map">
            <h2 class="card-title">
                <span>Kuramoto Oscillator Map</span>
            </h2>
            <div class="chart-container">
                <canvas id="resonance-chart"></canvas>
            </div>
        </div>
        
        <div class="footer">
            <p>QOTE Living Donut Simulation | Quantum Oscillator Thermodynamic Engine</p>
        </div>
    </div>

    <script>
        class KuramotoEngine {
            constructor(numOscillators = 50) {
                this.N = numOscillators;
                this.phases = new Array(this.N).fill(0).map(() => Math.random() * 2 * Math.PI);
                this.naturalFreqs = new Array(this.N).fill(0).map(() => Math.random() * 2 - 1); // Random frequencies
                this.dt = 0.01;
                this.time = 0;
            }

            // Calculate order parameter R (synchronization measure)
            calculateOrderParameter() {
                let sumCos = 0;
                let sumSin = 0;
                
                for (let i = 0; i < this.N; i++) {
                    sumCos += Math.cos(this.phases[i]);
                    sumSin += Math.sin(this.phases[i]);
                }
                
                const R = Math.sqrt(sumCos * sumCos + sumSin * sumSin) / this.N;
                return Math.min(R, 1.0); // Clamp to [0,1]
            }

            // Update oscillator phases using Kuramoto model
            updatePhases(coupling) {
                const newPhases = [...this.phases];
                const K = coupling * 0.1; // Scale coupling strength
                
                for (let i = 0; i < this.N; i++) {
                    let interaction = 0;
                    
                    // Calculate interaction with all other oscillators
                    for (let j = 0; j < this.N; j++) {
                        if (i !== j) {
                            interaction += Math.sin(this.phases[j] - this.phases[i]);
                        }
                    }
                    
                    // Kuramoto equation: dθ/dt = ω + (K/N) * Σsin(θj - θi)
                    newPhases[i] = this.phases[i] + this.dt * (
                        this.naturalFreqs[i] + (K / this.N) * interaction
                    );
                }
                
                this.phases = newPhases;
                this.time += this.dt;
            }

            // Generate phase difference distribution for visualization
            getPhaseDifferences() {
                const differences = [];
                for (let i = 0; i < Math.min(this.N, 20); i++) {
                    for (let j = i + 1; j < Math.min(this.N, 20); j++) {
                        let diff = Math.abs(this.phases[i] - this.phases[j]);
                        diff = Math.min(diff, 2 * Math.PI - diff); // Take smaller angle
                        differences.push(diff);
                    }
                }
                return differences;
            }

            // Get oscillator states for chart visualization
            getOscillatorStates(numSamples = 5) {
                const states = [];
                for (let i = 0; i < numSamples; i++) {
                    states.push({
                        phase: this.phases[i],
                        frequency: this.naturalFreqs[i],
                        x: Math.cos(this.phases[i]),
                        y: Math.sin(this.phases[i])
                    });
                }
                return states;
            }
        }

        // Initialize Kuramoto engine
        const kuramotoEngine = new KuramotoEngine(50);
        
        // Initialize Chart.js
        const ctx = document.getElementById('resonance-chart').getContext('2d');
        let resonanceChart;
        
        function initChart() {
            const data = {
                labels: ['0π', '0.5π', 'π', '1.5π', '2π'],
                datasets: [
                    {
                        label: 'Order Parameter R',
                        data: [0.2, 0.8, 0.4, 0.9, 0.5],
                        borderColor: '#6366f1',
                        backgroundColor: 'rgba(99, 102, 241, 0.1)',
                        tension: 0.4,
                        fill: true
                    },
                    {
                        label: 'Phase Coherence',
                        data: [0.7, 0.3, 0.6, 0.2, 0.8],
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4,
                        fill: true
                    }
                ]
            };
            
            const config = {
                type: 'line',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: '#94a3b8'
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8'
                            }
                        },
                        y: {
                            min: 0,
                            max: 1,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#94a3b8'
                            }
                        }
                    }
                }
            };
            
            resonanceChart = new Chart(ctx, config);
        }
        
        function updateChart(custValue, thetaValue) {
            // Update Kuramoto simulation
            const coupling = custValue / 100;
            const phaseBias = (thetaValue / 100) * Math.PI;
            
            // Run simulation steps
            for (let step = 0; step < 10; step++) {
                kuramotoEngine.updatePhases(coupling);
            }
            
            // Apply phase bias to simulate Delta Theta effect
            for (let i = 0; i < kuramotoEngine.N / 2; i++) {
                kuramotoEngine.phases[i] += phaseBias * 0.1;
            }
            
            const orderParam = kuramotoEngine.calculateOrderParameter();
            const phaseDiffs = kuramotoEngine.getPhaseDifferences();
            
            // Calculate phase coherence from phase differences
            const avgPhaseDiff = phaseDiffs.reduce((a, b) => a + b, 0) / phaseDiffs.length;
            const phaseCoherence = Math.max(0, 1 - (avgPhaseDiff / Math.PI));
            
            // Generate time series data for visualization
            const timePoints = ['0π', '0.5π', 'π', '1.5π', '2π'];
            const orderData = [];
            const coherenceData = [];
            
            for (let i = 0; i < 5; i++) {
                // Simulate temporal evolution
                const t = i * Math.PI / 2;
                const orderVariation = orderParam + 0.1 * Math.sin(t + coupling * Math.PI);
                const coherenceVariation = phaseCoherence + 0.1 * Math.cos(t + phaseBias);
                
                orderData.push(Math.max(0, Math.min(1, orderVariation)));
                coherenceData.push(Math.max(0, Math.min(1, coherenceVariation)));
            }
            
            resonanceChart.data.datasets[0].data = orderData;
            resonanceChart.data.datasets[1].data = coherenceData;
            resonanceChart.update();
            
            return orderParam;
        }
        
        // Initialize the UI
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize the chart
            initChart();
            
            // Get DOM elements
            const custInput = document.getElementById('cust-input');
            const custValue = document.getElementById('cust-value');
            const thetaInput = document.getElementById('theta-input');
            const thetaValue = document.getElementById('theta-value');
            const resonanceToggle = document.getElementById('resonance-toggle');
            const quantumToggle = document.getElementById('quantum-toggle');
            const optimizeBtn = document.getElementById('optimize-btn');
            const resetBtn = document.getElementById('reset-btn');
            const exportBtn = document.getElementById('export-btn');
            const deltaDisplay = document.getElementById('delta-display');
            const resonanceMap = document.querySelector('.resonance-map');
            
            // Set initial values
            updateDeltaDisplay();
            
            // Add event listeners
            custInput.addEventListener('input', function() {
                custValue.textContent = `${this.value}%`;
                updateDeltaDisplay();
                updateChart(this.value, thetaInput.value);
            });
            
            thetaInput.addEventListener('input', function() {
                thetaValue.textContent = `${this.value}%`;
                updateDeltaDisplay();
                updateChart(custInput.value, this.value);
            });
            
            resonanceToggle.addEventListener('change', function() {
                resonanceMap.style.display = this.checked ? 'block' : 'none';
            });
            
            quantumToggle.addEventListener('change', function() {
                const donut = document.querySelector('.donut');
                const coupling = parseInt(custInput.value) / 100;
                
                if (this.checked) {
                    // Higher coupling leads to faster synchronization
                    const syncSpeed = Math.max(5, 30 - coupling * 20);
                    donut.style.animationDuration = `${syncSpeed}s`;
                    document.querySelector('.status').textContent = 'ENTANGLED';
                    document.querySelector('.status').style.background = 'rgba(139, 92, 246, 0.2)';
                    document.querySelector('.status').style.color = '#8b5cf6';
                } else {
                    donut.style.animationDuration = '30s';
                    document.querySelector('.status').textContent = 'STABLE';
                    document.querySelector('.status').style.background = 'rgba(16, 185, 129, 0.2)';
                    document.querySelector('.status').style.color = '#10b981';
                }
            });
            
            optimizeBtn.addEventListener('click', function() {
                custInput.value = 85; // High coupling for synchronization
                custValue.textContent = '85%';
                thetaInput.value = 25; // Low phase difference
                thetaValue.textContent = '25%';
                
                updateDeltaDisplay();
                updateChart(85, 25);
                
                // Visual feedback
                this.textContent = 'Optimizing...';
                setTimeout(() => {
                    this.textContent = 'Optimize Parameters';
                }, 1500);
            });
            
            resetBtn.addEventListener('click', function() {
                // Reset to default values
                custInput.value = 50;
                custValue.textContent = '50%';
                thetaInput.value = 30;
                thetaValue.textContent = '30%';
                resonanceToggle.checked = true;
                quantumToggle.checked = false;
                
                resonanceMap.style.display = 'block';
                document.querySelector('.donut').style.animationDuration = '30s';
                document.querySelector('.status').textContent = 'STABLE';
                document.querySelector('.status').style.background = 'rgba(16, 185, 129, 0.2)';
                document.querySelector('.status').style.color = '#10b981';
                
                // Reset Kuramoto engine
                kuramotoEngine.phases = new Array(kuramotoEngine.N).fill(0).map(() => Math.random() * 2 * Math.PI);
                kuramotoEngine.time = 0;
                
                updateDeltaDisplay();
                updateChart(50, 30);
            });
            
            exportBtn.addEventListener('click', async function() {
                this.textContent = 'Exporting...';
                this.disabled = true;
                
                try {
                    // Capture the current state
                    const currentState = {
                        custGating: custInput.value,
                        deltaTheta: thetaInput.value,
                        orderParameter: deltaDisplay.textContent,
                        quantumEntanglement: quantumToggle.checked,
                        resonanceMapVisible: resonanceToggle.checked,
                        timestamp: new Date().toISOString(),
                        status: document.querySelector('.status').textContent
                    };
                    
                    // Create parameter summary
                    const parameterSummary = createParameterSummary(currentState);
                    
                    // Capture donut visualization
                    const donutImage = await captureDonutVisualization();
                    
                    // Capture chart if visible
                    let chartImage = null;
                    if (resonanceToggle.checked) {
                        chartImage = await captureChart();
                    }
                    
                    // Create and download ZIP file
                    await createExportPackage(parameterSummary, donutImage, chartImage, currentState);
                    
                } catch (error) {
                    console.error('Export failed:', error);
                    alert('Export failed. Please try again.');
                } finally {
                    this.textContent = 'Export for Deck';
                    this.disabled = false;
                }
            });
            
            function createParameterSummary(state) {
                return `
QOTE Living Donut - Parameter Summary
Generated: ${new Date(state.timestamp).toLocaleString()}

=== SIMULATION PARAMETERS ===
CUST Gating (Coupling Strength): ${state.custGating}%
Delta Theta (Phase Difference): ${state.deltaTheta}%
Order Parameter R: ${state.orderParameter}
System Status: ${state.status}
Quantum Entanglement: ${state.quantumEntanglement ? 'ENABLED' : 'DISABLED'}
Resonance Map: ${state.resonanceMapVisible ? 'VISIBLE' : 'HIDDEN'}

=== KURAMOTO MODEL ANALYSIS ===
Synchronization Level: ${parseFloat(state.orderParameter) > 0.8 ? 'HIGH' : parseFloat(state.orderParameter) > 0.5 ? 'MEDIUM' : 'LOW'}
Coupling Regime: ${parseInt(state.custGating) > 70 ? 'STRONG' : parseInt(state.custGating) > 30 ? 'MODERATE' : 'WEAK'}
Phase Coherence: ${parseInt(state.deltaTheta) < 30 ? 'HIGH' : parseInt(state.deltaTheta) < 70 ? 'MEDIUM' : 'LOW'}

=== INTERPRETATION ===
${generateInterpretation(state)}

=== TECHNICAL NOTES ===
- Order Parameter R ranges from 0 (incoherent) to 1 (fully synchronized)
- CUST Gating controls coupling strength between oscillators
- Delta Theta represents phase difference distribution
- Quantum Entanglement mode accelerates synchronization dynamics
- Based on Kuramoto oscillator model with ${kuramotoEngine.N} coupled oscillators

For questions about this simulation, contact: [Your Contact Information]
                `.trim();
            }
            
            function generateInterpretation(state) {
                const orderParam = parseFloat(state.orderParameter);
                const coupling = parseInt(state.custGating);
                const phaseDiff = parseInt(state.deltaTheta);
                
                if (orderParam > 0.8 && coupling > 70) {
                    return "System exhibits strong synchronization with high coupling strength. Optimal for demonstrating quantum coherence effects and collective behavior emergence.";
                } else if (orderParam > 0.5) {
                    return "System shows partial synchronization with moderate coherence. Suitable for studying transition dynamics and critical phenomena.";
                } else if (coupling < 30) {
                    return "Weak coupling regime with incoherent oscillator behavior. Demonstrates individual oscillator dynamics with minimal collective effects.";
                } else {
                    return "System in transition regime between incoherent and synchronized states. Ideal for studying critical coupling thresholds and phase transitions.";
                }
            }
            
            async function captureDonutVisualization() {
                return new Promise((resolve) => {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = 400;
                    canvas.height = 400;
                    
                    // Create gradient background
                    const bgGradient = ctx.createLinearGradient(0, 0, 400, 400);
                    bgGradient.addColorStop(0, '#0f172a');
                    bgGradient.addColorStop(1, '#1e293b');
                    ctx.fillStyle = bgGradient;
                    ctx.fillRect(0, 0, 400, 400);
                    
                    // Draw donut
                    const centerX = 200;
                    const centerY = 200;
                    const outerRadius = 120;
                    const innerRadius = 60;
                    
                    // Create conic gradient for donut
                    const gradient = ctx.createConicGradient(0, centerX, centerY);
                    gradient.addColorStop(0, '#6366f1');
                    gradient.addColorStop(0.2, '#10b981');
                    gradient.addColorStop(0.4, '#8b5cf6');
                    gradient.addColorStop(0.6, '#ec4899');
                    gradient.addColorStop(0.8, '#f59e0b');
                    gradient.addColorStop(1, '#6366f1');
                    
                    ctx.fillStyle = gradient;
                    ctx.beginPath();
                    ctx.arc(centerX, centerY, outerRadius, 0, 2 * Math.PI);
                    ctx.arc(centerX, centerY, innerRadius, 0, 2 * Math.PI, true);
                    ctx.fill();
                    
                    // Draw inner circle
                    ctx.fillStyle = '#1e293b';
                    ctx.beginPath();
                    ctx.arc(centerX, centerY, innerRadius, 0, 2 * Math.PI);
                    ctx.fill();
                    
                    // Add text
                    ctx.fillStyle = '#10b981';
                    ctx.font = 'bold 24px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(deltaDisplay.textContent, centerX, centerY - 10);
                    
                    ctx.fillStyle = '#94a3b8';
                    ctx.font = '14px Arial';
                    ctx.fillText('Order Parameter R', centerX, centerY + 15);
                    
                    ctx.fillStyle = document.querySelector('.status').style.color || '#10b981';
                    ctx.font = '12px Arial';
                    ctx.fillText(document.querySelector('.status').textContent, centerX, centerY + 35);
                    
                    resolve(canvas.toDataURL('image/png'));
                });
            }
            
            async function captureChart() {
                return new Promise((resolve) => {
                    const chartCanvas = document.getElementById('resonance-chart');
                    resolve(chartCanvas.toDataURL('image/png'));
                });
            }
            
            async function createExportPackage(summary, donutImage, chartImage, state) {
                // Create a simple download since we can't create ZIP files without additional libraries
                // Download parameter summary as text file
                const summaryBlob = new Blob([summary], { type: 'text/plain' });
                const summaryUrl = URL.createObjectURL(summaryBlob);
                
                // Download donut image
                const donutBlob = await fetch(donutImage).then(r => r.blob());
                const donutUrl = URL.createObjectURL(donutBlob);
                
                // Create download links
                const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, '-');
                
                // Download summary
                const summaryLink = document.createElement('a');
                summaryLink.href = summaryUrl;
                summaryLink.download = `QOTE-Parameters-${timestamp}.txt`;
                summaryLink.click();
                
                // Download donut visualization
                setTimeout(() => {
                    const donutLink = document.createElement('a');
                    donutLink.href = donutUrl;
                    donutLink.download = `QOTE-Donut-${timestamp}.png`;
                    donutLink.click();
                }, 500);
                
                // Download chart if available
                if (chartImage) {
                    setTimeout(async () => {
                        const chartBlob = await fetch(chartImage).then(r => r.blob());
                        const chartUrl = URL.createObjectURL(chartBlob);
                        const chartLink = document.createElement('a');
                        chartLink.href = chartUrl;
                        chartLink.download = `QOTE-Chart-${timestamp}.png`;
                        chartLink.click();
                        
                        // Cleanup URLs
                        setTimeout(() => {
                            URL.revokeObjectURL(summaryUrl);
                            URL.revokeObjectURL(donutUrl);
                            URL.revokeObjectURL(chartUrl);
                        }, 1000);
                    }, 1000);
                } else {
                    // Cleanup URLs
                    setTimeout(() => {
                        URL.revokeObjectURL(summaryUrl);
                        URL.revokeObjectURL(donutUrl);
                    }, 1000);
                }
                
                // Show success message
                setTimeout(() => {
                    alert('Export complete! Files have been downloaded to your Downloads folder.');
                }, 1500);
            }
            
            function updateDeltaDisplay() {
                const cust = parseInt(custInput.value);
                const theta = parseInt(thetaInput.value);
                
                // Calculate real order parameter from Kuramoto model
                const orderParam = updateChart(cust, theta);
                deltaDisplay.textContent = orderParam.toFixed(3);
                
                // Update status based on order parameter
                const statusElement = document.querySelector('.status');
                if (orderParam > 0.8) {
                    statusElement.textContent = 'SYNCHRONIZED';
                    statusElement.style.background = 'rgba(16, 185, 129, 0.2)';
                    statusElement.style.color = '#10b981';
                } else if (orderParam > 0.5) {
                    statusElement.textContent = 'COHERENT';
                    statusElement.style.background = 'rgba(59, 130, 246, 0.2)';
                    statusElement.style.color = '#3b82f6';
                } else {
                    statusElement.textContent = 'INCOHERENT';
                    statusElement.style.background = 'rgba(239, 68, 68, 0.2)';
                    statusElement.style.color = '#ef4444';
                }
            }
        });
    </script>
</body>
</html>
