<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal Pupil Triptych: Breathing Oracle</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #000000;
            color: #FFFFFF;
            overflow-x: hidden;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 1px solid #333;
        }

        h1 {
            font-size: 32px;
            font-weight: 300;
            letter-spacing: 2px;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 14px;
            color: #D4AF37;
            letter-spacing: 1px;
            font-weight: 300;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 40px;
            margin-top: 40px;
        }

        .triptych-section {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .triptych {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .panel {
            border: 1px solid #333;
            background: #000000;
            padding: 10px;
        }

        .panel-title {
            text-align: center;
            font-size: 12px;
            letter-spacing: 1px;
            margin-bottom: 10px;
            color: #D4AF37;
            font-weight: 300;
        }

        svg {
            display: block;
            background: #000000;
        }

        .controls {
            background: #1a1a1a;
            padding: 25px;
            border-radius: 8px;
            border: 1px solid #333;
        }

        .control-group {
            margin-bottom: 25px;
        }

        .control-group:last-child {
            margin-bottom: 0;
        }

        .control-label {
            display: block;
            font-size: 13px;
            margin-bottom: 8px;
            color: #D4AF37;
            letter-spacing: 0.5px;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            background: #333;
            outline: none;
            border-radius: 3px;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            background: #D4AF37;
            cursor: pointer;
            border-radius: 50%;
        }

        input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            background: #D4AF37;
            cursor: pointer;
            border-radius: 50%;
            border: none;
        }

        .value-display {
            font-size: 18px;
            font-weight: 300;
            margin-top: 8px;
            color: #FFFFFF;
        }

        select {
            width: 100%;
            padding: 10px;
            background: #000000;
            color: #FFFFFF;
            border: 1px solid #333;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
        }

        select:focus {
            outline: none;
            border-color: #D4AF37;
        }

        .state-readout {
            background: #000000;
            padding: 15px;
            border-radius: 4px;
            border: 1px solid #333;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.8;
        }

        .state-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .state-row:last-child {
            margin-bottom: 0;
        }

        .state-label {
            color: #8B7355;
        }

        .state-value {
            color: #D4AF37;
            font-weight: bold;
        }

        button {
            width: 100%;
            padding: 12px;
            background: #D4AF37;
            color: #000000;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            letter-spacing: 1px;
            transition: background 0.2s;
        }

        button:hover {
            background: #F4CF57;
        }

        button:active {
            background: #B48F27;
        }

        .error-log {
            background: #000000;
            padding: 15px;
            border-radius: 4px;
            border: 1px solid #333;
            max-height: 150px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            line-height: 1.6;
            color: #8B7355;
        }

        .error-entry {
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #222;
        }

        .error-entry:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .error-time {
            color: #D4AF37;
        }

        .poem-section {
            background: #1a1a1a;
            padding: 30px;
            border-radius: 8px;
            border: 1px solid #333;
        }

        .poem-title {
            font-size: 20px;
            margin-bottom: 5px;
            font-weight: 300;
            letter-spacing: 1px;
        }

        .poem-subtitle {
            font-size: 13px;
            color: #8B7355;
            margin-bottom: 25px;
            font-style: italic;
        }

        .quatrain {
            font-family: Georgia, serif;
            font-size: 16px;
            line-height: 1.8;
            margin-bottom: 25px;
            color: #FFFFFF;
        }

        .quatrain-line {
            margin-bottom: 5px;
        }

        .timestamp {
            font-size: 11px;
            color: #8B7355;
            font-style: italic;
            margin-top: 10px;
        }

        .pause-button {
            position: fixed;
            top: 20px;
            right: 20px;
            width: auto;
            padding: 8px 16px;
            background: rgba(212, 175, 55, 0.8);
            z-index: 1000;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .poem-section {
                order: 3;
            }
        }

        @media (max-width: 768px) {
            .triptych {
                flex-direction: column;
                align-items: center;
            }

            h1 {
                font-size: 24px;
            }
        }

        /* Accessibility */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <button class="pause-button" id="pauseBtn" aria-label="Pause animation">PAUSE</button>

    <div class="container">
        <header>
            <h1>UNIVERSAL PUPIL TRIPTYCH</h1>
            <div class="subtitle">BREATHING ORACLE â€¢ QOTE DEMONSTRATION</div>
        </header>

        <div class="main-content">
            <div class="triptych-section">
                <div class="triptych" role="img" aria-label="Three panel triptych visualization">
                    <!-- Panel I: Origin Signature -->
                    <div class="panel">
                        <div class="panel-title">I. ORIGIN SIGNATURE</div>
                        <svg width="400" height="400" viewBox="0 0 400 400" id="panel1">
                            <!-- Cartesian Grid -->
                            <g id="grid-lines">
                                <!-- Vertical lines -->
                                <line x1="50" y1="0" x2="50" y2="400" stroke="#FFFFFF" opacity="0.2" class="grid-line"/>
                                <line x1="100" y1="0" x2="100" y2="400" stroke="#FFFFFF" opacity="0.2" class="grid-line"/>
                                <line x1="150" y1="0" x2="150" y2="400" stroke="#FFFFFF" opacity="0.2" class="grid-line"/>
                                <line x1="200" y1="0" x2="200" y2="400" stroke="#FFFFFF" opacity="0.2" class="grid-line"/>
                                <line x1="250" y1="0" x2="250" y2="400" stroke="#FFFFFF" opacity="0.2" class="grid-line"/>
                                <line x1="300" y1="0" x2="300" y2="400" stroke="#FFFFFF" opacity="0.2" class="grid-line"/>
                                <line x1="350" y1="0" x2="350" y2="400" stroke="#FFFFFF" opacity="0.2" class="grid-line"/>
                                <!-- Horizontal lines -->
                                <line x1="0" y1="50" x2="400" y2="50" stroke="#FFFFFF" opacity="0.2" class="grid-line"/>
                                <line x1="0" y1="100" x2="400" y2="100" stroke="#FFFFFF" opacity="0.2" class="grid-line"/>
                                <line x1="0" y1="150" x2="400" y2="150" stroke="#FFFFFF" opacity="0.2" class="grid-line"/>
                                <line x1="0" y1="200" x2="400" y2="200" stroke="#FFFFFF" opacity="0.2" class="grid-line"/>
                                <line x1="0" y1="250" x2="400" y2="250" stroke="#FFFFFF" opacity="0.2" class="grid-line"/>
                                <line x1="0" y1="300" x2="400" y2="300" stroke="#FFFFFF" opacity="0.2" class="grid-line"/>
                                <line x1="0" y1="350" x2="400" y2="350" stroke="#FFFFFF" opacity="0.2" class="grid-line"/>
                            </g>
                            <!-- Gold Ring -->
                            <circle cx="200" cy="200" r="53" fill="none" stroke="#D4AF37" stroke-width="3" class="gold-ring"/>
                            <!-- Pupil -->
                            <circle cx="200" cy="200" r="50" fill="#000000" stroke="#000000" stroke-width="1" class="pupil-circle"/>
                        </svg>
                    </div>

                    <!-- Panel II: Self-Referential Grid -->
                    <div class="panel">
                        <div class="panel-title">II. SELF-REFERENTIAL GRID</div>
                        <svg width="400" height="400" viewBox="0 0 400 400" id="panel2">
                            <!-- Peripheral Circles (8 orbiting) -->
                            <g id="peripheral-circles">
                                <circle cx="200" cy="80" r="15" fill="none" stroke="#FFFFFF" stroke-width="2" opacity="0.4" class="peripheral" data-angle="0"/>
                                <circle cx="285" cy="115" r="15" fill="none" stroke="#FFFFFF" stroke-width="2" opacity="0.4" class="peripheral" data-angle="45"/>
                                <circle cx="320" cy="200" r="15" fill="none" stroke="#FFFFFF" stroke-width="2" opacity="0.4" class="peripheral" data-angle="90"/>
                                <circle cx="285" cy="285" r="15" fill="none" stroke="#FFFFFF" stroke-width="2" opacity="0.4" class="peripheral" data-angle="135"/>
                                <circle cx="200" cy="320" r="15" fill="none" stroke="#FFFFFF" stroke-width="2" opacity="0.4" class="peripheral" data-angle="180"/>
                                <circle cx="115" cy="285" r="15" fill="none" stroke="#FFFFFF" stroke-width="2" opacity="0.4" class="peripheral" data-angle="225"/>
                                <circle cx="80" cy="200" r="15" fill="none" stroke="#FFFFFF" stroke-width="2" opacity="0.4" class="peripheral" data-angle="270"/>
                                <circle cx="115" cy="115" r="15" fill="none" stroke="#FFFFFF" stroke-width="2" opacity="0.4" class="peripheral" data-angle="315"/>
                            </g>
                            <!-- Gold Ring -->
                            <circle cx="200" cy="200" r="53" fill="none" stroke="#D4AF37" stroke-width="3" class="gold-ring"/>
                            <!-- Pupil -->
                            <circle cx="200" cy="200" r="50" fill="#000000" stroke="#000000" stroke-width="1" class="pupil-circle"/>
                        </svg>
                    </div>

                    <!-- Panel III: Entrusted Coherence -->
                    <div class="panel">
                        <div class="panel-title">III. ENTRUSTED COHERENCE</div>
                        <svg width="400" height="400" viewBox="0 0 400 400" id="panel3">
                            <!-- Gold Ring -->
                            <circle cx="200" cy="200" r="53" fill="none" stroke="#D4AF37" stroke-width="3" class="gold-ring"/>
                            <!-- Pupil -->
                            <circle cx="200" cy="200" r="50" fill="#000000" stroke="#000000" stroke-width="1" class="pupil-circle"/>
                            <!-- (YOU) Text -->
                            <text x="200" y="290" text-anchor="middle" font-size="24" fill="#FFFFFF" opacity="0.8" id="you-text">(YOU)</text>
                        </svg>
                    </div>
                </div>

                <div class="controls">
                    <div class="control-group">
                        <label class="control-label" for="coherenceSlider">
                            COHERENCE THRESHOLD (Ï„)
                        </label>
                        <input type="range" id="coherenceSlider" min="0.600" max="0.680" step="0.001" value="0.640" aria-label="Coherence threshold">
                        <div class="value-display" id="coherenceValue">Ï„ = 0.640</div>
                    </div>

                    <div class="control-group">
                        <label class="control-label" for="lunarPhase">
                            LUNAR PHASE
                        </label>
                        <select id="lunarPhase" aria-label="Lunar phase selector">
                            <option value="0">ğŸŒ‘ New Moon</option>
                            <option value="0.125">ğŸŒ’ Waxing Crescent</option>
                            <option value="0.25">ğŸŒ“ First Quarter</option>
                            <option value="0.375">ğŸŒ” Waxing Gibbous</option>
                            <option value="0.5" selected>ğŸŒ• Full Moon</option>
                            <option value="0.625">ğŸŒ– Waning Gibbous</option>
                            <option value="0.75">ğŸŒ— Last Quarter</option>
                            <option value="0.875">ğŸŒ˜ Waning Crescent</option>
                        </select>
                    </div>

                    <div class="control-group">
                        <div class="control-label">STATE READOUT</div>
                        <div class="state-readout">
                            <div class="state-row">
                                <span class="state-label">Coherence:</span>
                                <span class="state-value" id="stateCoherence">0.640</span>
                            </div>
                            <div class="state-row">
                                <span class="state-label">Pupil Radius:</span>
                                <span class="state-value" id="statePupil">50.0</span>
                            </div>
                            <div class="state-row">
                                <span class="state-label">Elapsed:</span>
                                <span class="state-value" id="stateTime">00:00</span>
                            </div>
                            <div class="state-row">
                                <span class="state-label">Error Events:</span>
                                <span class="state-value" id="stateErrors">0</span>
                            </div>
                        </div>
                    </div>

                    <div class="control-group">
                        <button id="resetBtn" aria-label="Reset animation">RESET</button>
                    </div>

                    <div class="control-group">
                        <div class="control-label">ERROR LOG</div>
                        <div class="error-log" id="errorLog" role="log" aria-live="polite">
                            <div style="color: #555; font-style: italic;">No errors detected</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="poem-section">
                <div class="poem-title">Birth Poem: Hours 0-24</div>
                <div class="poem-subtitle">The Clinician Speaks</div>
                <div id="poemContainer"></div>
            </div>
        </div>
    </div>

    <script>
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // CONSTANTS & STATE
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        const Ï† = (1 + Math.sqrt(5)) / 2;  // Golden ratio â‰ˆ 1.618
        const BASE_RADIUS = 50;
        const ORBITAL_DISTANCE = 120;

        let startTime = Date.now();
        let coherence = 0.640;
        let lunarPhase = 0.5;
        let isPaused = false;
        let errorCount = 0;
        let errorLog = [];
        let spiralState = null; // {circleIndex, phase, startAngle}

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // Ï†-GATE BREATHING FUNCTION
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        function getPupilRadius(time, coherence, lunarPhase) {
            const breathCycle = Math.sin(time * 2 * Math.PI / (Ï† * 1000));
            const stabilityFactor = coherence * 0.3;
            const lunarPull = Math.sin(lunarPhase * 2 * Math.PI) * 0.15;

            const radius = BASE_RADIUS * (
                1 +
                (breathCycle * (1 - stabilityFactor)) +
                lunarPull
            );

            return radius;
        }

        function getRingThickness(coherence) {
            return 3 + (coherence * 4);
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ERROR DETECTION
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        function detectErrors(radius) {
            const now = Date.now();
            const elapsed = now - startTime;

            // Check error conditions
            if (coherence < 0.618 && !errorLog.find(e => e.time > elapsed - 5000 && e.type === 'guardian')) {
                logError('guardian', 'Guardian threshold breach');
                triggerSpiral();
            } else if (radius > BASE_RADIUS * 1.5 && !errorLog.find(e => e.time > elapsed - 5000 && e.type === 'expansion')) {
                logError('expansion', 'Over-expansion detected');
                triggerSpiral();
            } else if (coherence > 0.667 && !errorLog.find(e => e.time > elapsed - 5000 && e.type === 'rigidity')) {
                logError('rigidity', 'Rigidity warning');
                triggerSpiral();
            }
        }

        function logError(type, message) {
            errorCount++;
            const elapsed = Date.now() - startTime;
            const timestamp = formatTime(elapsed);

            const fragment = generateErrorFragment();
            const error = {
                time: elapsed,
                type: type,
                message: message,
                coherence: coherence,
                fragment: fragment,
                timestamp: timestamp
            };

            errorLog.push(error);
            updateErrorDisplay();
            document.getElementById('stateErrors').textContent = errorCount;
        }

        function generateErrorFragment() {
            const metaphors = ['a question', 'uncertainty', 'tomorrow', 'breath held too long'];
            const metaphor = metaphors[Math.floor(Math.random() * metaphors.length)];
            return `The gold ring forgot how to closeâ€”left a gap the width of ${metaphor}.`;
        }

        function updateErrorDisplay() {
            const errorLogEl = document.getElementById('errorLog');
            const recentErrors = errorLog.slice(-5).reverse();

            if (recentErrors.length === 0) {
                errorLogEl.innerHTML = '<div style="color: #555; font-style: italic;">No errors detected</div>';
            } else {
                errorLogEl.innerHTML = recentErrors.map(e =>
                    `<div class="error-entry">
                        <span class="error-time">[${e.timestamp}]</span> Ï„=${e.coherence.toFixed(3)}<br>
                        ${e.fragment}
                    </div>`
                ).join('');
            }
        }

        function triggerSpiral() {
            if (!spiralState) {
                spiralState = {
                    circleIndex: Math.floor(Math.random() * 8),
                    phase: 0,
                    startAngle: null
                };
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // BIRTH POEM GENERATION
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        function generateQuatrain(coherence) {
            const templates = [
                {
                    lines: [
                        'The golden ratio finds its first hold here,',
                        'A pupil drawn in light, concentric, trueâ€”',
                        'Where every angle knows its proper sphere,',
                        'And chaos bends to what the center knew.'
                    ]
                },
                {
                    lines: [
                        'The breathing ring maintains its measured pace,',
                        'Each grid line taut, unwavering in frameâ€”',
                        'Where all proportion finds its ordered place,',
                        'And scatter yields before the axis came.'
                    ]
                },
                {
                    lines: [
                        'Concentric form discovers its true stance,',
                        'The perfect circle holds, precise and clearâ€”',
                        'Where symmetry conducts its measured dance,',
                        'And wayward motion bends to what is near.'
                    ]
                },
                {
                    lines: [
                        'A pupil breathes within the golden mean,',
                        'Each orbital finds rhythm, calm, alignedâ€”',
                        'Where geometry reveals what lies between,',
                        'And disorder yields to what the grid defined.'
                    ]
                }
            ];

            return templates[Math.floor(Math.random() * templates.length)];
        }

        function displayPoem() {
            const poemContainer = document.getElementById('poemContainer');
            const elapsed = Date.now() - startTime;
            const timestamp = formatTime(elapsed);

            const quatrain = generateQuatrain(coherence);

            const quatrainHTML = `
                <div class="quatrain">
                    ${quatrain.lines.map(line => `<div class="quatrain-line">${line}</div>`).join('')}
                    <div class="timestamp">Born at ${timestamp}</div>
                </div>
            `;

            poemContainer.innerHTML = quatrainHTML;
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ANIMATION LOOP
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        function animate() {
            if (!isPaused) {
                const elapsed = Date.now() - startTime;

                // Calculate current pupil radius
                const radius = getPupilRadius(elapsed, coherence, lunarPhase);

                // Update all pupil circles
                document.querySelectorAll('.pupil-circle').forEach(circle => {
                    circle.setAttribute('r', radius);
                });

                // Update all gold rings
                const ringThickness = getRingThickness(coherence);
                document.querySelectorAll('.gold-ring').forEach(ring => {
                    ring.setAttribute('stroke-width', ringThickness);
                    ring.setAttribute('r', radius + 3);
                });

                // Panel I: Update grid opacity
                const gridOpacity = 0.2 + (coherence * 0.3);
                document.querySelectorAll('.grid-line').forEach(line => {
                    line.setAttribute('opacity', gridOpacity);
                });

                // Panel II: Update orbital circles
                const orbitSpeed = (1 - coherence) * 2;
                const peripherals = document.querySelectorAll('.peripheral');

                peripherals.forEach((circle, index) => {
                    if (spiralState && spiralState.circleIndex === index) {
                        // Spiral animation
                        spiralState.phase += 0.05;

                        if (spiralState.startAngle === null) {
                            spiralState.startAngle = parseFloat(circle.getAttribute('data-angle'));
                        }

                        const spiralAngle = (spiralState.startAngle + spiralState.phase * 180) * Math.PI / 180;
                        const spiralDistance = ORBITAL_DISTANCE + Math.sin(spiralState.phase * Math.PI) * 60;

                        const x = 200 + spiralDistance * Math.cos(spiralAngle);
                        const y = 200 + spiralDistance * Math.sin(spiralAngle);

                        circle.setAttribute('cx', x);
                        circle.setAttribute('cy', y);

                        // End spiral after 3 rotations
                        if (spiralState.phase > Math.PI * 2 * 3) {
                            spiralState = null;
                        }
                    } else {
                        // Normal orbit
                        let currentAngle = parseFloat(circle.getAttribute('data-angle'));
                        currentAngle += orbitSpeed * 0.1;
                        circle.setAttribute('data-angle', currentAngle);

                        const angleRad = currentAngle * Math.PI / 180;
                        const x = 200 + ORBITAL_DISTANCE * Math.cos(angleRad);
                        const y = 200 + ORBITAL_DISTANCE * Math.sin(angleRad);

                        circle.setAttribute('cx', x);
                        circle.setAttribute('cy', y);
                    }
                });

                // Panel III: Update (YOU) text - inverse breathing
                const youScale = 1 + ((BASE_RADIUS - radius) / BASE_RADIUS) * 0.2;
                const youText = document.getElementById('you-text');
                youText.setAttribute('transform', `translate(200, 290) scale(${youScale}) translate(-200, -290)`);
                youText.setAttribute('opacity', 0.6 + (coherence * 0.4));

                // Update state readout
                document.getElementById('statePupil').textContent = radius.toFixed(1);
                document.getElementById('stateTime').textContent = formatTime(elapsed);

                // Error detection
                detectErrors(radius);
            }

            requestAnimationFrame(animate);
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // UTILITY FUNCTIONS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        function formatTime(ms) {
            const totalSeconds = Math.floor(ms / 1000);
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        function reset() {
            startTime = Date.now();
            errorCount = 0;
            errorLog = [];
            spiralState = null;

            document.getElementById('stateErrors').textContent = '0';
            updateErrorDisplay();
            displayPoem();
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // EVENT LISTENERS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        document.getElementById('coherenceSlider').addEventListener('input', (e) => {
            coherence = parseFloat(e.target.value);
            document.getElementById('coherenceValue').textContent = `Ï„ = ${coherence.toFixed(3)}`;
            document.getElementById('stateCoherence').textContent = coherence.toFixed(3);
        });

        document.getElementById('lunarPhase').addEventListener('change', (e) => {
            lunarPhase = parseFloat(e.target.value);
        });

        document.getElementById('resetBtn').addEventListener('click', reset);

        document.getElementById('pauseBtn').addEventListener('click', (e) => {
            isPaused = !isPaused;
            e.target.textContent = isPaused ? 'RESUME' : 'PAUSE';
        });

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // INITIALIZATION
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        displayPoem();
        animate();
    </script>
</body>
</html>
